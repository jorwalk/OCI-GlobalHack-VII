{"version":3,"sources":["node_modules/nodebb-plugin-composer-default/static/lib/composer/controls.js"],"names":["define","preview","controls","insertIntoTextarea","textarea","value","$textarea","$","currentVal","val","postContainer","parents","slice","selectionStart","render","wrapSelectionInTextareaWith","leading","trailing","undefined","matches","exec","selectionEnd","length","updateTextareaSelection","start","end","setSelectionRange","focus","getBlockData","textareaEl","query","replace","regex","RegExp","match","matchIndices","payload","split","reduce","memo","line","push","index","in","cur","atEnd"],"mappings":"AAAA,aAIAA,OAAO,qBAAsB,oBAAqB,SAASC,GAC1D,IAAIC,KAKJA,EAASC,mBAAqB,SAASC,EAAUC,GAChD,IAAIC,EAAYC,EAAEH,GAClB,IAAII,EAAaF,EAAUG,MAC3B,IAAIC,EAAgBJ,EAAUK,QAAQ,0BAEtCL,EAAUG,IACTD,EAAWI,MAAM,EAAGR,EAASS,gBAC7BR,EACAG,EAAWI,MAAMR,EAASS,iBAG3BZ,EAAQa,OAAOJ,IAGhBR,EAASa,4BAA8B,SAASX,EAAUY,EAASC,GAClE,GAAIA,IAAaC,UAAW,CAC3BD,EAAWD,EAGZ,IAAIV,EAAYC,EAAEH,GAClB,IAAII,EAAaF,EAAUG,MAE3B,IAAIU,EAAU,yBAAyBC,KAAKZ,EAAWI,MAAMR,EAASS,eAAgBT,EAASiB,eAE/F,IAAKF,EAAQ,GAAI,CAEhBA,GAAW,KAAM,GAAIX,EAAWI,MAAMR,EAASS,eAAgBT,EAASiB,cAAe,IAGxFf,EAAUG,IACTD,EAAWI,MAAM,EAAGR,EAASS,gBAC7BM,EAAQ,GACRH,EACAG,EAAQ,GACRF,EACAE,EAAQ,GACRX,EAAWI,MAAMR,EAASiB,eAG3B,OAAQF,EAAQ,GAAGG,OAAQH,EAAQ,GAAGG,SAGvCpB,EAASqB,wBAA0B,SAASnB,EAAUoB,EAAOC,GAC5DrB,EAASsB,kBAAkBF,EAAOC,GAClClB,EAAEH,GAAUuB,SAGbzB,EAAS0B,aAAe,SAAUC,EAAYC,EAAOjB,GAEpD,IAAIR,EAAQwB,EAAWxB,MACvByB,EAAQA,EAAMC,QAAQ,sCAAuC,QAC7D,IAAIC,EAAQ,IAAIC,OAAOH,EAAO,KAC9B,IAAII,EACJ,IAAIC,KACJ,IAAIC,EAGJ/B,EAAQA,EAAMgC,MAAM,MAAMC,OAAO,SAAUC,EAAMC,GAChD,GAAID,IAAS,KAAM,CAClB,OAAOA,EAGRA,EAAO1B,GAAkB2B,EAAKlB,OAASkB,EAAO,KAE9C,GAAID,IAAS,KAAM,CAClB1B,EAAiBA,GAAkB2B,EAAKlB,OAAS,GAGlD,OAAOiB,GACL,MAGH,OAAOL,EAAQF,EAAMZ,KAAKf,MAAY,KAAM,CAC3C8B,EAAaM,KAAKP,EAAMQ,OAGzBN,GACCO,MAAOR,EAAaG,OAAO,SAAUC,EAAMK,GAC1C,GAAI/B,GAAkB+B,EAAM,EAAG,CAC9BL,GAAQ,EAGT,OAAOA,GACL,GAAK,GACRM,MAAOV,EAAaG,OAAO,SAAUC,EAAMK,GAC1C,GAAIL,EAAM,CACT,OAAOA,EAGR,OAAO1B,IAAmB+B,GACxB,QAGJR,EAAQS,MAAQT,EAAQO,GAAKP,EAAQS,MAAQ,MAC7C,OAAOT,GAGR,OAAOlC","file":"node_modules/nodebb-plugin-composer-default/static/lib/composer/controls.js","sourcesContent":["\"use strict\";\n\n/*global define*/\n\ndefine('composer/controls', ['composer/preview'], function(preview) {\n\tvar controls = {};\n\n\t/*************************************************/\n\t/* Rich Textarea Controls                        */\n\t/*************************************************/\n\tcontrols.insertIntoTextarea = function(textarea, value) {\n\t\tvar $textarea = $(textarea);\n\t\tvar currentVal = $textarea.val();\n\t\tvar postContainer = $textarea.parents('[component=\"composer\"]');\n\n\t\t$textarea.val(\n\t\t\tcurrentVal.slice(0, textarea.selectionStart) +\n\t\t\tvalue +\n\t\t\tcurrentVal.slice(textarea.selectionStart)\n\t\t);\n\n\t\tpreview.render(postContainer);\n\t};\n\n\tcontrols.wrapSelectionInTextareaWith = function(textarea, leading, trailing){\n\t\tif (trailing === undefined) {\n\t\t\ttrailing = leading;\n\t\t}\n\n\t\tvar $textarea = $(textarea);\n\t\tvar currentVal = $textarea.val();\n\n\t\tvar matches = /^(\\s*)([\\s\\S]*?)(\\s*)$/.exec(currentVal.slice(textarea.selectionStart, textarea.selectionEnd));\n\n\t\tif (!matches[2]) {\n\t\t\t// selection is entirely whitespace\n\t\t\tmatches = [null, '', currentVal.slice(textarea.selectionStart, textarea.selectionEnd), ''];\n\t\t}\n\n\t\t$textarea.val(\n\t\t\tcurrentVal.slice(0, textarea.selectionStart) +\n\t\t\tmatches[1] +\n\t\t\tleading +\n\t\t\tmatches[2] +\n\t\t\ttrailing +\n\t\t\tmatches[3] +\n\t\t\tcurrentVal.slice(textarea.selectionEnd)\n\t\t);\n\n\t\treturn [matches[1].length, matches[3].length];\n\t};\n\n\tcontrols.updateTextareaSelection = function(textarea, start, end){\n\t\ttextarea.setSelectionRange(start, end);\n\t\t$(textarea).focus();\n\t};\n\n\tcontrols.getBlockData = function (textareaEl, query, selectionStart) {\n\t\t// Determines whether the cursor is sitting inside a block-type element (bold, italic, etc.)\n\t\tvar value = textareaEl.value;\n\t\tquery = query.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, \"\\\\$&\");\n\t\tvar regex = new RegExp(query, 'g');\n\t\tvar match;\n\t\tvar matchIndices = [];\n\t\tvar payload;\n\n\t\t// Isolate the line the cursor is on\n\t\tvalue = value.split('\\n').reduce(function (memo, line) {\n\t\t\tif (memo !== null) {\n\t\t\t\treturn memo;\n\t\t\t}\n\n\t\t\tmemo = selectionStart <= line.length ? line : null;\n\n\t\t\tif (memo === null) {\n\t\t\t\tselectionStart = selectionStart - (line.length + 1);\n\t\t\t}\n\n\t\t\treturn memo;\n\t\t}, null);\n\n\t\t// Find query characters and determine return payload\n\t\twhile((match = regex.exec(value)) !== null) {\n\t\t\tmatchIndices.push(match.index);\n\t\t}\n\n\t\tpayload = {\n\t\t\tin: !!(matchIndices.reduce(function (memo, cur) {\n\t\t\t\tif (selectionStart >= cur + 2) {\n\t\t\t\t\tmemo += 1;\n\t\t\t\t}\n\n\t\t\t\treturn memo;\n\t\t\t}, 0) % 2),\n\t\t\tatEnd: matchIndices.reduce(function (memo, cur) {\n\t\t\t\tif (memo) {\n\t\t\t\t\treturn memo;\n\t\t\t\t}\n\n\t\t\t\treturn selectionStart === cur;\n\t\t\t}, false),\n\t\t}\n\n\t\tpayload.atEnd = payload.in ? payload.atEnd : false;\n\t\treturn payload;\n\t}\n\n\treturn controls;\n});\n"]}