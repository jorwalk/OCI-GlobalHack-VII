{"version":3,"sources":["public/src/modules/flags.js"],"names":["define","Benchpress","Flag","flagModal","flagCommit","flagReason","showFlagModal","data","parseModal","html","$","on","remove","find","reportText","this","text","val","length","createFlag","type","id","bootbox","confirm","title","message","callback","result","prop","focus","modal","checkFlagButtonEnable","tplData","parse","require","translator","translate","reason","socket","emit","err","app","alertError","alertSuccess","removeAttr","attr"],"mappings":"AAAA,aAGAA,OAAO,SAAU,cAAe,SAAUC,GACzC,IAAIC,KACJ,IAAIC,EACJ,IAAIC,EACJ,IAAIC,EAEJH,EAAKI,cAAgB,SAAUC,GAC9BC,EAAWD,EAAM,SAAUE,GAC1BN,EAAYO,EAAED,GAEdN,EAAUQ,GAAG,kBAAmB,WAC/BR,EAAUS,WAGXR,EAAaD,EAAUU,KAAK,qBAC5BR,EAAaF,EAAUU,KAAK,uBAG5BV,EAAUQ,GAAG,QAAS,eAAgB,WACrC,IAAIG,EAAaJ,EAAEK,MAAMC,OAEzB,GAAIX,EAAWY,MAAMC,SAAW,EAAG,CAClC,OAAOC,EAAWZ,EAAKa,KAAMb,EAAKc,GAAIP,GAIvCQ,QAAQC,SACPC,MAAO,iCACPC,QAAS,+GACTC,SAAU,SAAUC,GACnB,GAAIA,EAAQ,CACXR,EAAWZ,EAAKa,KAAMb,EAAKc,GAAIP,SAOnCV,EAAWO,GAAG,QAAS,WACtBQ,EAAWZ,EAAKa,KAAMb,EAAKc,GAAIlB,EAAUU,KAAK,uBAAuBI,SAGtEd,EAAUQ,GAAG,QAAS,iBAAkB,WACvCN,EAAWuB,KAAK,WAAY,OAC5BvB,EAAWwB,UAGZ1B,EAAU2B,MAAM,QAEhB3B,EAAUU,KAAK,uBAAuBF,GAAG,oBAAqBoB,MAIhE,SAASvB,EAAWwB,EAASN,GAC5BzB,EAAWgC,MAAM,6BAA8BD,EAAS,SAAUvB,GACjEyB,SAAS,cAAe,SAAUC,GACjCA,EAAWC,UAAU3B,EAAMiB,OAK9B,SAASP,EAAWC,EAAMC,EAAIgB,GAC7B,IAAKjB,IAASC,IAAOgB,EAAQ,CAC5B,OAEDC,OAAOC,KAAK,gBAAkBnB,KAAMA,EAAMC,GAAIA,EAAIgB,OAAQA,GAAU,SAAUG,GAC7E,GAAIA,EAAK,CACR,OAAOC,IAAIC,WAAWF,EAAIf,SAG3BtB,EAAU2B,MAAM,QAChBW,IAAIE,aAAa,oCAInB,SAASZ,IACR,GAAI5B,EAAUU,KAAK,uBAAuBI,MAAO,CAChDb,EAAWwC,WAAW,gBAChB,CACNxC,EAAWyC,KAAK,WAAY,OAI9B,OAAO3C","file":"public/src/modules/flags.js","sourcesContent":["'use strict';\n\n\ndefine('flags', ['benchpress'], function (Benchpress) {\n\tvar Flag = {};\n\tvar flagModal;\n\tvar flagCommit;\n\tvar flagReason;\n\n\tFlag.showFlagModal = function (data) {\n\t\tparseModal(data, function (html) {\n\t\t\tflagModal = $(html);\n\n\t\t\tflagModal.on('hidden.bs.modal', function () {\n\t\t\t\tflagModal.remove();\n\t\t\t});\n\n\t\t\tflagCommit = flagModal.find('#flag-post-commit');\n\t\t\tflagReason = flagModal.find('#flag-reason-custom');\n\n\t\t\t// Quick-report buttons\n\t\t\tflagModal.on('click', '.flag-reason', function () {\n\t\t\t\tvar reportText = $(this).text();\n\n\t\t\t\tif (flagReason.val().length === 0) {\n\t\t\t\t\treturn createFlag(data.type, data.id, reportText);\n\t\t\t\t}\n\n\t\t\t\t// Custom reason has text, confirm submission\n\t\t\t\tbootbox.confirm({\n\t\t\t\t\ttitle: '[[flags:modal-submit-confirm]]',\n\t\t\t\t\tmessage: '<p>[[flags:modal-submit-confirm-text]]</p><p class=\"help-block\">[[flags:modal-submit-confirm-text-help]]</p>',\n\t\t\t\t\tcallback: function (result) {\n\t\t\t\t\t\tif (result) {\n\t\t\t\t\t\t\tcreateFlag(data.type, data.id, reportText);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t});\n\n\t\t\t// Custom reason report submission\n\t\t\tflagCommit.on('click', function () {\n\t\t\t\tcreateFlag(data.type, data.id, flagModal.find('#flag-reason-custom').val());\n\t\t\t});\n\n\t\t\tflagModal.on('click', '.toggle-custom', function () {\n\t\t\t\tflagReason.prop('disabled', false);\n\t\t\t\tflagReason.focus();\n\t\t\t});\n\n\t\t\tflagModal.modal('show');\n\n\t\t\tflagModal.find('#flag-reason-custom').on('keyup blur change', checkFlagButtonEnable);\n\t\t});\n\t};\n\n\tfunction parseModal(tplData, callback) {\n\t\tBenchpress.parse('partials/modals/flag_modal', tplData, function (html) {\n\t\t\trequire(['translator'], function (translator) {\n\t\t\t\ttranslator.translate(html, callback);\n\t\t\t});\n\t\t});\n\t}\n\n\tfunction createFlag(type, id, reason) {\n\t\tif (!type || !id || !reason) {\n\t\t\treturn;\n\t\t}\n\t\tsocket.emit('flags.create', { type: type, id: id, reason: reason }, function (err) {\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\n\t\t\tflagModal.modal('hide');\n\t\t\tapp.alertSuccess('[[flags:modal-submit-success]]');\n\t\t});\n\t}\n\n\tfunction checkFlagButtonEnable() {\n\t\tif (flagModal.find('#flag-reason-custom').val()) {\n\t\t\tflagCommit.removeAttr('disabled');\n\t\t} else {\n\t\t\tflagCommit.attr('disabled', true);\n\t\t}\n\t}\n\n\treturn Flag;\n});\n"]}