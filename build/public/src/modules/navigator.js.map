{"version":3,"sources":["public/src/modules/navigator.js"],"names":["define","pagination","components","navigator","index","count","navigatorUpdateTimeoutId","scrollActive","$","window","on","off","onKeyDown","init","selector","toTop","toBottom","callback","calculateIndex","delayedUpdate","e","stopPropagation","setTimeout","focus","scrollUp","scrollDown","which","input","this","utils","isNumber","val","parseInt","url","generateUrl","trigger","ajaxify","go","handleKeys","setCount","update","config","usePagination","ev","target","nodeName","shiftKey","ctrlKey","altKey","pathname","location","replace","relative_path","parts","split","value","updateTextAndProgressBar","show","toggle","disable","flag","path","removeRelativePath","slice","startsWith","toggleClass","undefined","threshold","els","length","first","attr","scrollTop","windowHeight","height","documentHeight","document","middleOfViewport","previousDistance","Number","MAX_VALUE","each","distanceToMiddle","Math","abs","offset","top","atTop","nearBottom","last","data","template","topic","anchorEl","get","anchorRect","getBoundingClientRect","relIndex","getRelativeIndex","translateHtml","fraction","width","topicPostSort","postcount","$window","previousPage","animate","atBottom","nextPage","scrollToIndex","scrollBottom","highlight","duration","inTopic","inCategory","scrollToPostIndex","scrollToTopicIndex","scrollMethod","categoryTopicSort","topic_count","page","max","ceil","postsPerPage","currentPage","loadPage","postIndex","scrollTo","scrollToElement","topicIndex","postHeight","viewportHeight","navbarHeight","done","animateScroll","scrollToRect","highlightPost","addClass","removeClass"],"mappings":"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","file":"public/src/modules/navigator.js","sourcesContent":["'use strict';\n\ndefine('navigator', ['forum/pagination', 'components'], function (pagination, components) {\n\tvar navigator = {};\n\tvar index = 1;\n\tvar count = 0;\n\tvar navigatorUpdateTimeoutId;\n\n\tnavigator.scrollActive = false;\n\n\t$(window).on('action:ajaxify.start', function () {\n\t\t$(window).off('keydown', onKeyDown);\n\t});\n\n\tnavigator.init = function (selector, count, toTop, toBottom, callback, calculateIndex) {\n\t\tindex = 1;\n\t\tnavigator.selector = selector;\n\t\tnavigator.callback = callback;\n\t\tnavigator.toTop = toTop || function () {};\n\t\tnavigator.toBottom = toBottom || function () {};\n\n\t\t$(window).off('scroll', navigator.delayedUpdate).on('scroll', navigator.delayedUpdate);\n\n\t\t$('.pagination-block .dropdown-menu').off('click').on('click', function (e) {\n\t\t\te.stopPropagation();\n\t\t});\n\n\t\t$('.pagination-block').off('shown.bs.dropdown', '.dropdown').on('shown.bs.dropdown', '.dropdown', function () {\n\t\t\tsetTimeout(function () {\n\t\t\t\t$('.pagination-block input').focus();\n\t\t\t}, 100);\n\t\t});\n\n\t\t$('.pagination-block .pageup').off('click').on('click', navigator.scrollUp);\n\t\t$('.pagination-block .pagedown').off('click').on('click', navigator.scrollDown);\n\t\t$('.pagination-block .pagetop').off('click').on('click', navigator.toTop);\n\t\t$('.pagination-block .pagebottom').off('click').on('click', navigator.toBottom);\n\n\t\t$('.pagination-block input').on('keydown', function (e) {\n\t\t\tif (e.which === 13) {\n\t\t\t\tvar input = $(this);\n\t\t\t\tif (!utils.isNumber(input.val())) {\n\t\t\t\t\tinput.val('');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar index = parseInt(input.val(), 10);\n\t\t\t\tif (typeof calculateIndex === 'function') {\n\t\t\t\t\tindex = calculateIndex(index, count);\n\t\t\t\t}\n\n\t\t\t\tvar url = generateUrl(index);\n\t\t\t\tinput.val('');\n\t\t\t\t$('.pagination-block .dropdown-toggle').trigger('click');\n\t\t\t\tajaxify.go(url);\n\t\t\t}\n\t\t});\n\n\t\thandleKeys();\n\n\t\tnavigator.setCount(count);\n\t\tnavigator.update(0);\n\t};\n\n\tfunction handleKeys() {\n\t\tif (!config.usePagination) {\n\t\t\t$(window).off('keydown', onKeyDown).on('keydown', onKeyDown);\n\t\t}\n\t}\n\n\tfunction onKeyDown(ev) {\n\t\tif (ev.target.nodeName === 'BODY') {\n\t\t\tif (ev.shiftKey || ev.ctrlKey || ev.altKey) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (ev.which === 36 && navigator.toTop) { // home key\n\t\t\t\tnavigator.toTop();\n\t\t\t\treturn false;\n\t\t\t} else if (ev.which === 35 && navigator.toBottom) { // end key\n\t\t\t\tnavigator.toBottom();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction generateUrl(index) {\n\t\tvar pathname = window.location.pathname.replace(config.relative_path, '');\n\t\tvar parts = pathname.split('/');\n\t\treturn parts[1] + '/' + parts[2] + '/' + parts[3] + (index ? '/' + index : '');\n\t}\n\n\tnavigator.setCount = function (value) {\n\t\tcount = parseInt(value, 10);\n\t\tnavigator.updateTextAndProgressBar();\n\t};\n\n\tnavigator.show = function () {\n\t\ttoggle(true);\n\t};\n\n\tnavigator.disable = function () {\n\t\tcount = 0;\n\t\tindex = 1;\n\t\tnavigator.callback = null;\n\t\tnavigator.selector = null;\n\t\t$(window).off('scroll', navigator.delayedUpdate);\n\n\t\ttoggle(false);\n\t};\n\n\tfunction toggle(flag) {\n\t\tvar path = ajaxify.removeRelativePath(window.location.pathname.slice(1));\n\t\tif (flag && (!path.startsWith('topic') && !path.startsWith('category'))) {\n\t\t\treturn;\n\t\t}\n\n\t\t$('.pagination-block').toggleClass('ready', flag);\n\t}\n\n\tnavigator.delayedUpdate = function () {\n\t\tif (!navigatorUpdateTimeoutId) {\n\t\t\tnavigatorUpdateTimeoutId = setTimeout(function () {\n\t\t\t\tnavigator.update();\n\t\t\t\tnavigatorUpdateTimeoutId = undefined;\n\t\t\t}, 100);\n\t\t}\n\t};\n\n\tnavigator.update = function (threshold) {\n\t\t/*\n\t\t\tThe \"threshold\" is defined as the distance from the top of the page to\n\t\t\ta spot where a user is expecting to begin reading.\n\t\t*/\n\t\tthreshold = typeof threshold === 'number' ? threshold : undefined;\n\n\t\tvar els = $(navigator.selector);\n\t\tif (els.length) {\n\t\t\tindex = parseInt(els.first().attr('data-index'), 10) + 1;\n\t\t}\n\n\t\tvar scrollTop = $(window).scrollTop();\n\t\tvar windowHeight = $(window).height();\n\t\tvar documentHeight = $(document).height();\n\t\tvar middleOfViewport = scrollTop + (windowHeight / 2);\n\t\tvar previousDistance = Number.MAX_VALUE;\n\t\tels.each(function () {\n\t\t\tvar distanceToMiddle = Math.abs(middleOfViewport - $(this).offset().top);\n\n\t\t\tif (distanceToMiddle > previousDistance) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (distanceToMiddle < previousDistance) {\n\t\t\t\tindex = parseInt($(this).attr('data-index'), 10) + 1;\n\t\t\t\tpreviousDistance = distanceToMiddle;\n\t\t\t}\n\t\t});\n\n\t\tvar atTop = scrollTop === 0 && parseInt(els.first().attr('data-index'), 10) === 0;\n\t\tvar nearBottom = scrollTop + windowHeight > documentHeight - 100 && parseInt(els.last().attr('data-index'), 10) === count - 1;\n\n\t\tif (atTop) {\n\t\t\tindex = 1;\n\t\t} else if (nearBottom) {\n\t\t\tindex = count;\n\t\t}\n\n\t\t// If a threshold is undefined, try to determine one based on new index\n\t\tif (threshold === undefined && ajaxify.data.template.topic === true) {\n\t\t\tif (atTop) {\n\t\t\t\tthreshold = 0;\n\t\t\t} else {\n\t\t\t\tvar anchorEl = components.get('post/anchor', index - 1);\n\t\t\t\tif (anchorEl.length) {\n\t\t\t\t\tvar anchorRect = anchorEl.get(0).getBoundingClientRect();\n\t\t\t\t\tthreshold = anchorRect.top;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (typeof navigator.callback === 'function') {\n\t\t\tnavigator.callback(index, count, threshold);\n\t\t}\n\n\t\tnavigator.updateTextAndProgressBar();\n\t\ttoggle(!!count);\n\t};\n\n\tnavigator.updateTextAndProgressBar = function () {\n\t\tif (!utils.isNumber(index)) {\n\t\t\treturn;\n\t\t}\n\t\tindex = index > count ? count : index;\n\t\tvar relIndex = getRelativeIndex();\n\t\t$('.pagination-block .pagination-text').translateHtml('[[global:pagination.out_of, ' + relIndex + ', ' + count + ']]');\n\t\tvar fraction = (relIndex - 1) / (count - 1 || 1);\n\t\t$('.pagination-block meter').val(fraction);\n\t\t$('.pagination-block .progress-bar').width((fraction * 100) + '%');\n\t};\n\n\tfunction getRelativeIndex() {\n\t\tvar relIndex = index;\n\t\tif (relIndex === 1) {\n\t\t\treturn 1;\n\t\t}\n\t\tif (ajaxify.data.template.topic) {\n\t\t\tif (config.topicPostSort === 'most_votes' || config.topicPostSort === 'newest_to_oldest') {\n\t\t\t\trelIndex = ajaxify.data.postcount - index + 2;\n\t\t\t}\n\t\t}\n\t\treturn relIndex;\n\t}\n\n\tnavigator.scrollUp = function () {\n\t\tvar $window = $(window);\n\n\t\tif (config.usePagination) {\n\t\t\tvar atTop = $window.scrollTop() <= 0;\n\t\t\tif (atTop) {\n\t\t\t\treturn pagination.previousPage(function () {\n\t\t\t\t\t$('body,html').scrollTop($(document).height() - $window.height());\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\t$('body,html').animate({\n\t\t\tscrollTop: $window.scrollTop() - $window.height(),\n\t\t});\n\t};\n\n\tnavigator.scrollDown = function () {\n\t\tvar $window = $(window);\n\n\t\tif (config.usePagination) {\n\t\t\tvar atBottom = $window.scrollTop() >= $(document).height() - $window.height();\n\t\t\tif (atBottom) {\n\t\t\t\treturn pagination.nextPage();\n\t\t\t}\n\t\t}\n\t\t$('body,html').animate({\n\t\t\tscrollTop: $window.scrollTop() + $window.height(),\n\t\t});\n\t};\n\n\tnavigator.scrollTop = function (index) {\n\t\tif ($(navigator.selector + '[data-index=\"' + index + '\"]').length) {\n\t\t\tnavigator.scrollToIndex(index, true);\n\t\t} else {\n\t\t\tajaxify.go(generateUrl());\n\t\t}\n\t};\n\n\tnavigator.scrollBottom = function (index) {\n\t\tif (parseInt(index, 10) < 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ($(navigator.selector + '[data-index=\"' + index + '\"]').length) {\n\t\t\tnavigator.scrollToIndex(index, true);\n\t\t} else {\n\t\t\tindex = parseInt(index, 10) + 1;\n\t\t\tajaxify.go(generateUrl(index));\n\t\t}\n\t};\n\n\tnavigator.scrollToIndex = function (index, highlight, duration) {\n\t\tvar inTopic = !!components.get('topic').length;\n\t\tvar inCategory = !!components.get('category').length;\n\n\t\tif (!utils.isNumber(index) || (!inTopic && !inCategory)) {\n\t\t\treturn;\n\t\t}\n\n\t\tduration = duration !== undefined ? duration : 400;\n\t\tnavigator.scrollActive = true;\n\n\t\t// if in topic and item already on page\n\t\tif (inTopic && components.get('post/anchor', index).length) {\n\t\t\treturn navigator.scrollToPostIndex(index, highlight, duration);\n\t\t}\n\n\t\t// if in category and item alreay on page\n\t\tif (inCategory && $('[component=\"category/topic\"][data-index=\"' + index + '\"]').length) {\n\t\t\treturn navigator.scrollToTopicIndex(index, highlight, duration);\n\t\t}\n\n\t\tif (!config.usePagination) {\n\t\t\tnavigator.scrollActive = false;\n\t\t\tindex = parseInt(index, 10) + 1;\n\t\t\tajaxify.go(generateUrl(index));\n\t\t\treturn;\n\t\t}\n\n\t\tvar scrollMethod = inTopic ? navigator.scrollToPostIndex : navigator.scrollToTopicIndex;\n\t\tif (inTopic) {\n\t\t\tif (config.topicPostSort === 'most_votes' || config.topicPostSort === 'newest_to_oldest') {\n\t\t\t\tindex = ajaxify.data.postcount - index;\n\t\t\t}\n\t\t} else if (inCategory) {\n\t\t\tif (config.categoryTopicSort === 'most_posts' || config.categoryTopicSort === 'oldest_to_newest') {\n\t\t\t\tindex = ajaxify.data.topic_count - index;\n\t\t\t}\n\t\t}\n\n\t\tvar page = Math.max(1, Math.ceil((index + 1) / config.postsPerPage));\n\n\t\tif (parseInt(page, 10) !== ajaxify.data.pagination.currentPage) {\n\t\t\tpagination.loadPage(page, function () {\n\t\t\t\tscrollMethod(index, highlight, duration);\n\t\t\t});\n\t\t} else {\n\t\t\tscrollMethod(index, highlight, duration);\n\t\t}\n\t};\n\n\tnavigator.scrollToPostIndex = function (postIndex, highlight, duration) {\n\t\tvar scrollTo = components.get('post', 'index', postIndex);\n\t\tnavigator.scrollToElement(scrollTo, highlight, duration);\n\t};\n\n\tnavigator.scrollToTopicIndex = function (topicIndex, highlight, duration) {\n\t\tvar scrollTo = $('[component=\"category/topic\"][data-index=\"' + topicIndex + '\"]');\n\t\tnavigator.scrollToElement(scrollTo, highlight, duration);\n\t};\n\n\tnavigator.scrollToElement = function (scrollTo, highlight, duration) {\n\t\tif (!scrollTo.length) {\n\t\t\tnavigator.scrollActive = false;\n\t\t\treturn;\n\t\t}\n\t\tvar postHeight = scrollTo.height();\n\t\tvar viewportHeight = $(window).height();\n\t\tvar navbarHeight = components.get('navbar').height();\n\n\t\t// Temporarily disable navigator update on scroll\n\t\t$(window).off('scroll', navigator.update);\n\n\t\tduration = duration !== undefined ? duration : 400;\n\t\tnavigator.scrollActive = true;\n\t\tvar done = false;\n\n\t\tfunction animateScroll() {\n\t\t\tvar scrollTop = 0;\n\t\t\tif (postHeight < viewportHeight) {\n\t\t\t\tscrollTop = (scrollTo.offset().top - (viewportHeight / 2) + (postHeight / 2));\n\t\t\t} else {\n\t\t\t\tscrollTop = scrollTo.offset().top - navbarHeight;\n\t\t\t}\n\n\t\t\t$('html, body').animate({\n\t\t\t\tscrollTop: scrollTop + 'px',\n\t\t\t}, duration, function () {\n\t\t\t\tif (done) {\n\t\t\t\t\t// Re-enable onScroll behaviour\n\t\t\t\t\t$(window).on('scroll', navigator.update);\n\t\t\t\t\tvar scrollToRect = scrollTo.get(0).getBoundingClientRect();\n\t\t\t\t\tnavigator.update(scrollToRect.top);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tdone = true;\n\n\t\t\t\tnavigator.scrollActive = false;\n\t\t\t\thighlightPost();\n\t\t\t\t$('body').scrollTop($('body').scrollTop() - 1);\n\t\t\t\t$('html').scrollTop($('html').scrollTop() - 1);\n\t\t\t});\n\t\t}\n\n\t\tfunction highlightPost() {\n\t\t\tif (highlight) {\n\t\t\t\tscrollTo.addClass('highlight');\n\t\t\t\tsetTimeout(function () {\n\t\t\t\t\tscrollTo.removeClass('highlight');\n\t\t\t\t}, 10000);\n\t\t\t}\n\t\t}\n\n\t\tanimateScroll();\n\t};\n\n\treturn navigator;\n});\n"]}