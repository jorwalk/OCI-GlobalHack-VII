{"version":3,"sources":["public/src/client/topic/diffs.js"],"names":["define","Images","Benchpress","translator","Diffs","open","pid","config","enablePostHistory","localeStringOpts","year","month","day","hour","minute","socket","emit","err","timestamps","app","alertError","message","parse","diffs","map","timestamp","parseInt","pretty","Date","toLocaleString","userLang","replace","numDiffs","length","html","translate","modal","bootbox","dialog","title","size","selectEl","find","postContainer","on","load","this","value","val","since","data","deleted","parseAndTranslate","posts","empty","append","unloadImages","loadImages"],"mappings":"AAAA,aAEAA,OAAO,qBAAsB,qBAAsB,aAAc,cAAe,SAAUC,EAAQC,EAAYC,GAC7G,IAAIC,KAEJA,EAAMC,KAAO,SAAUC,GACtB,IAAKC,OAAOC,kBAAmB,CAC9B,OAGD,IAAIC,GAAqBC,KAAM,UAAWC,MAAO,QAASC,IAAK,UAAWC,KAAM,UAAWC,OAAQ,WAEnGC,OAAOC,KAAK,kBAAoBV,IAAKA,GAAO,SAAUW,EAAKC,GAC1D,GAAID,EAAK,CACR,OAAOE,IAAIC,WAAWH,EAAII,SAG3BnB,EAAWoB,MAAM,gCAChBC,MAAOL,EAAWM,IAAI,SAAUC,GAC/BA,EAAYC,SAASD,EAAW,IAEhC,OACCA,UAAWA,EACXE,OAAQ,IAAIC,KAAKH,GAAWI,eAAetB,OAAOuB,SAASC,QAAQ,IAAK,KAAMtB,MAGhFuB,SAAUd,EAAWe,QACnB,SAAUC,GACZ/B,EAAWgC,UAAUD,EAAM,SAAUA,GACpC,IAAIE,EAAQC,QAAQC,QACnBC,MAAO,wBACPlB,QAASa,EACTM,KAAM,UAGP,IAAKtB,EAAWe,OAAQ,CACvB,OAGD,IAAIQ,EAAWL,EAAMM,KAAK,UAC1B,IAAIC,EAAgBP,EAAMM,KAAK,iBAE/BD,EAASG,GAAG,SAAU,WACrBxC,EAAMyC,KAAKvC,EAAKwC,KAAKC,MAAOJ,KAG7BP,EAAMQ,GAAG,iBAAkB,WAC1BxC,EAAMyC,KAAKvC,EAAKmC,EAASO,MAAOL,YAOrCvC,EAAMyC,KAAO,SAAUvC,EAAK2C,EAAON,GAClC,IAAKpC,OAAOC,kBAAmB,CAC9B,OAGDO,OAAOC,KAAK,oBAAsBV,IAAKA,EAAK2C,MAAOA,GAAS,SAAUhC,EAAKiC,GAC1E,GAAIjC,EAAK,CACR,OAAOE,IAAIC,WAAWH,EAAII,SAG3B6B,EAAKC,UAAYzB,SAASwB,EAAKC,QAAS,IAExChC,IAAIiC,kBAAkB,sBAAuB,SAC5CC,OAAQH,IACN,SAAUhB,GACZS,EAAcW,QAAQC,OAAOrB,GAC7BjC,EAAOuD,aAAatB,GACpBjC,EAAOwD,kBAKV,OAAOrD","file":"public/src/client/topic/diffs.js","sourcesContent":["'use strict';\n\ndefine('forum/topic/diffs', ['forum/topic/images', 'benchpress', 'translator'], function (Images, Benchpress, translator) {\n\tvar Diffs = {};\n\n\tDiffs.open = function (pid) {\n\t\tif (!config.enablePostHistory) {\n\t\t\treturn;\n\t\t}\n\n\t\tvar localeStringOpts = { year: 'numeric', month: 'short', day: 'numeric', hour: 'numeric', minute: 'numeric' };\n\n\t\tsocket.emit('posts.getDiffs', { pid: pid }, function (err, timestamps) {\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\n\t\t\tBenchpress.parse('partials/modals/post_history', {\n\t\t\t\tdiffs: timestamps.map(function (timestamp) {\n\t\t\t\t\ttimestamp = parseInt(timestamp, 10);\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttimestamp: timestamp,\n\t\t\t\t\t\tpretty: new Date(timestamp).toLocaleString(config.userLang.replace('_', '-'), localeStringOpts),\n\t\t\t\t\t};\n\t\t\t\t}),\n\t\t\t\tnumDiffs: timestamps.length,\n\t\t\t}, function (html) {\n\t\t\t\ttranslator.translate(html, function (html) {\n\t\t\t\t\tvar modal = bootbox.dialog({\n\t\t\t\t\t\ttitle: '[[topic:diffs.title]]',\n\t\t\t\t\t\tmessage: html,\n\t\t\t\t\t\tsize: 'large',\n\t\t\t\t\t});\n\n\t\t\t\t\tif (!timestamps.length) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar selectEl = modal.find('select');\n\t\t\t\t\tvar postContainer = modal.find('ul.posts-list');\n\n\t\t\t\t\tselectEl.on('change', function () {\n\t\t\t\t\t\tDiffs.load(pid, this.value, postContainer);\n\t\t\t\t\t});\n\n\t\t\t\t\tmodal.on('shown.bs.modal', function () {\n\t\t\t\t\t\tDiffs.load(pid, selectEl.val(), postContainer);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t};\n\n\tDiffs.load = function (pid, since, postContainer) {\n\t\tif (!config.enablePostHistory) {\n\t\t\treturn;\n\t\t}\n\n\t\tsocket.emit('posts.showPostAt', { pid: pid, since: since }, function (err, data) {\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\n\t\t\tdata.deleted = !!parseInt(data.deleted, 10);\n\n\t\t\tapp.parseAndTranslate('partials/posts_list', 'posts', {\n\t\t\t\tposts: [data],\n\t\t\t}, function (html) {\n\t\t\t\tpostContainer.empty().append(html);\n\t\t\t\tImages.unloadImages(html);\n\t\t\t\tImages.loadImages();\n\t\t\t});\n\t\t});\n\t};\n\n\treturn Diffs;\n});\n"]}